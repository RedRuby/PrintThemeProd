{% include 'customer-account-common-code' with 'theme-layout-code' %}

<div class="grid">
  {% assign bypass = false %}
  <div class="grid__item post-large--two-thirds push--post-large--one-sixth">
    
    <div>
      
      {% form 'contact', onsubmit:"" %}

        {% if form.posted_successfully? or bypass %}
          {% if fs_shop_active %}
          <div class="text-center">
            <h1>Thank you for registering!<br><br>You will receive an email with your account details.</h1>
            <br><br>
            <a href="/account/login"><button class="btn btn-primary min-width-150" type="button">Login</button></a>
          </div>
          {% else %}
          <p class="note text-center form-success success-custom-color">
            {{ 'contact.form.post_success' | t }}
          </p>
          {% endif %}
        {%else%}

          <div class="section-header  text-center">
            <h1 class="section-header--title">{{ page.title }}</h1>
            <label for=""><span style="color: red;">* </span>Indicates Required Field</label>
          </div>

          <div class="rte">
            {{ page.content }}
          </div>

          {% if form.errors %}
          <div class="errorForm feedback">
            <!-- {{ form.errors.size }} or {{ form.errors | size }} -->
            <p>Your contact form has {{ form.errors | size | pluralize: 'an error', 'a few errors' }}. To submit your form, make the following changes and try again:</p>
            {% for field in form.errors %}
              <p>The {{ field | capitalize | replace: 'Body', 'Message' }} field {{ form.errors.messages[field] }}.</p>
            {% endfor %}
          </div>
          {% endif %}

        {% assign name_attr = 'contact.form.name' | t | handle %}
        <label for="ContactFormFirstName" class="label--hidden1">First Name</label>
        <input type="text" required id="ContactFormFirstName" name="contact[FirstName]" placeholder="First Name" autocapitalize="words" value="{% if form[name_attr] %}{{ form[name_attr] }}{% endif %}">
      
        <label for="ContactFormLastName" class="label--hidden1">Last Name</label>
        <input type="text" required id="ContactFormLastName" name="contact[LastName]" placeholder="Last Name" autocapitalize="words" value="{% if form[name_attr] %}{{ form[name_attr] }}{% endif %}">

        <label for="ContactFormEmail" class="label--hidden1">{{ 'contact.form.email' | t }}</label>
        <input type="email" required id="ContactFormEmail" name="contact[email]" pattern="[\w.%+-_]+@pepsico\.com" title="Enter a valid company email" placeholder="{{ 'contact.form.email' | t }}" autocorrect="off" autocapitalize="off" value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}">

        {% assign name_attr = 'contact.form.phone' | t | handle %}
        <label for="ContactFormPhone" class="label--hidden1">{{ 'contact.form.phone' | t }}</label>
        <input type="tel" required id="ContactFormPhone" name="contact[{{ name_attr }}]" placeholder="{{ 'contact.form.phone' | t }}" pattern="[0-9\-]*" value="{% if form[name_attr] %}{{ form[name_attr] }}{% elsif customer %}{{ customer.phone }}{% endif %}">
      
        <label for="ContactFormStreet" class="label--hidden1">{{ 'contact.form.address' | t }}</label>
        <input id="ContactFormStreet" required type="text" name="contact[street]" valued="{{ shop.address.street }}">
      
        <label for="ContactFormCity" class="label--hidden1">{{ 'contact.form.city' | t }}</label>
        <input id="ContactFormCity" required type="text" name="contact[city]" valued="{{ shop.address.city }}">
      
        <label for="ContactFormZip" class="label--hidden1">{{ 'contact.form.zip' | t }}</label>
        <input id="ContactFormZip" required type="text" name="contact[zip]" valued="{{ shop.address.zip }}">
      
        <label for="ContactFormProvince" class="label--hidden1">{{ 'contact.form.province' | t }}</label>
<!--         <input id="ContactFormProvince" required type="text" name="contact[province]" valued="{{ shop.address.province }}"> -->
        <select title="Enter Province" required id="ContactFormProvince" name="contact[province]">
          <option style="color:#666; background-color:lightgrey;" value="" disabled selected>State</option>
          <option style="color:#666; background-color:white;" value="AL">Alabama, AL</option>
          <option style="color:#666; background-color:white;" value="AK">Alaska, AK</option>
          <option style="color:#666; background-color:white;" value="AZ">Arizona, AZ</option>
          <option style="color:#666; background-color:white;" value="AR">Arkansas, AR</option>
          <option style="color:#666; background-color:white;" value="CA">California, CA</option>
          <option style="color:#666; background-color:white;" value="CO">Colorado, CO</option>
          <option style="color:#666; background-color:white;" value="CT">Connecticut, CT</option>
          <option style="color:#666; background-color:white;" value="DE">Delaware, DE</option>
          <option style="color:#666; background-color:white;" value="DC">District of Columbia, DC</option>
          <option style="color:#666; background-color:white;" value="FL">Florida, FL</option>
          <option style="color:#666; background-color:white;" value="GA">Georgia, GA</option>
          <option style="color:#666; background-color:white;" value="HI">Hawaii, HI</option>
          <option style="color:#666; background-color:white;" value="ID">Idaho, ID</option>
          <option style="color:#666; background-color:white;" value="IL">Illinois, IL</option>
          <option style="color:#666; background-color:white;" value="IN">Indiana, IN</option>
          <option style="color:#666; background-color:white;" value="IA">Iowa, IA</option>
          <option style="color:#666; background-color:white;" value="KS">Kansas, KS</option>
          <option style="color:#666; background-color:white;" value="KY">Kentucky, KY</option>
          <option style="color:#666; background-color:white;" value="LA">Louisiana, LA</option>
          <option style="color:#666; background-color:white;" value="ME">Maine,  ME</option>
          <option style="color:#666; background-color:white;" value="MD">Maryland,  MD</option>
          <option style="color:#666; background-color:white;" value="MA">Massachusetts,  MA</option>
          <option style="color:#666; background-color:white;" value="MI">Michigan,  MI</option>
          <option style="color:#666; background-color:white;" value="MN">Minnesota,  MN</option>
          <option style="color:#666; background-color:white;" value="MS">Mississippi,  MS</option>
          <option style="color:#666; background-color:white;" value="MO">Missouri,  MO</option>
          <option style="color:#666; background-color:white;" value="MT">Montana,  MT</option>
          <option style="color:#666; background-color:white;" value="NE">Nebraska,  NE</option>
          <option style="color:#666; background-color:white;" value="NV">Nevada,  NV</option>
          <option style="color:#666; background-color:white;" value="NH">New Hampshire,  NH</option>
          <option style="color:#666; background-color:white;" value="NJ">New Jersey,  NJ</option>
          <option style="color:#666; background-color:white;" value="NM">New Mexico,  NM</option>
          <option style="color:#666; background-color:white;" value="NY">New York,  NY</option>
          <option style="color:#666; background-color:white;" value="NC">North Carolina,  NC</option>
          <option style="color:#666; background-color:white;" value="ND">North Dakota,  ND</option>
          <option style="color:#666; background-color:white;" value="OH">Ohio,  OH</option>
          <option style="color:#666; background-color:white;" value="OK">Oklahoma,  OK</option>
          <option style="color:#666; background-color:white;" value="OR">Oregon,  OR</option>
          <option style="color:#666; background-color:white;" value="PA">Pennsylvania,  PA</option>
          <option style="color:#666; background-color:white;" value="RI">Rhode Island,  RI</option>
          <option style="color:#666; background-color:white;" value="SC">South Carolina,  SC</option>
          <option style="color:#666; background-color:white;" value="SD">South Dakota,  SD</option>
          <option style="color:#666; background-color:white;" value="TN">Tennessee,  TN</option>
          <option style="color:#666; background-color:white;" value="TX">Texas,  TX</option>
          <option style="color:#666; background-color:white;" value="UT">Utah,  UT</option>
          <option style="color:#666; background-color:white;" value="VT">Vermont,  VT</option>
          <option style="color:#666; background-color:white;" value="VA">Virginia,  VA</option>
          <option style="color:#666; background-color:white;" value="WA">Washington,  WA</option>
          <option style="color:#666; background-color:white;" value="WV">West Virginia,  WV</option>
          <option style="color:#666; background-color:white;" value="WI">Wisconsin,  WI</option>
          <option style="color:#666; background-color:white;" value="WY">Wyoming,  WY</option>
        </select>

        {% if fs_shop_active %}
        <label for="ContactFormDivision" class="label--hidden1">{{ 'Division' }}</label>
        <select name="contact[division]" id="ContactFormDivision" required="" onchange="onRegionChange(this);">
          <option value="">Select</option>
          <option value="Division:North">North</option>
          <option value="Division:West">West</option>
          <option value="Division:Central">Central</option>
          <option value="Division:Distributor">Distributor</option>
          <option value="Division:South">South</option>
          <option value="Division:NationalCustomer">National Customer</option>
          <option value='Division:FranchiseBottler'>Franchise Bottler</option>
        </select>
        
        <label for="ContactFormLegacyRegion" class="label--hidden1">{{ 'Legacy Region' }}</label>
        <select name="contact[legacy_region]" id="ContactFormLegacyRegion" required="" onchange="onRegionChange(this);">
          <option style="color:#666; background-color:lightgray;" value="" selected disabled>Select</option>
          <option style="color:#666;" value='Region:California'>California</option>
          <option style="color:#666;" value='Region:Distributor'>Distributor</option>
          <option style="color:#666;" value='Region:FranchiseBottler'>Franchise Bottler</option>
          <option style="color:#666;" value='Region:GreatLakes'>Great Lakes</option>
          <option style="color:#666;" value='Region:MidAtlantic'>Mid-Atlantic</option>
          <option style="color:#666;" value='Region:Mountain'>Mountain</option>
          <option style="color:#666;" value='Region:MidWest'>Midwest</option>
          <option style="color:#666;" value='Region:NationalCustomer'>National Customer</option>
          <option style="color:#666;" value='Region:NorthEast'>Northeast</option>
          <option style="color:#666;" value='Region:S0uth'>South</option>
          <option style="color:#666;" value='Region:SouthEast'>Southeast</option>
        </select>

        <input type="hidden" name="contact[modregion]">
        <input type="hidden" name="contact[moddivision]">

        <label for="ContactFormChannel" class="label--hidden1">{{ 'Channel' }}</label>
        <select name="contact[channel]" id="ContactFormChannel" required="" onchange="onRegionChange(this);">
          <option value="">Select</option>
          {% assign channels = "general.mod_channels" | t | split: "," | sort %}
          {% for channel in channels %}
          <option value="Channel:{{ channel }}">{{ channel }}</option>
          {% endfor %}
        </select>
        {% endif %}

        <label for="ContactFormCountry" class="label--hidden1">{{ 'contact.form.country' | t }}</label>
        <input id="ContactFormCountry" readonly required type="text" name="contact[country]" value="{{ shop.address.country }}"> 
      
        {%comment%} 
        <label for="ContactFormCompanyName" class="label--hidden1">Company Name</label>
        <input type="text" required id="ContactFormCompanyName" name="contact[CompanyName]" placeholder="Company Name">

        <label for="ContactFormFunction" class="label--hidden1">Function</label>
        <select name="contact[function]" title="Function" required id="ContactFormFunction" style="color: rgb(163,163,163);" onchange="this.style.color = '#666';" >
          <option style="color:#666; background-color:lightgray;" value="" selected disabled>Select Function</option>
          <option style="color:#666;" value='ASM'>ASM</option>
          <option style="color:#666;" value='Printer'>Printer</option>
          <option style="color:#666;" value='Print Shop'>Print Shop</option>
          <option style="color:#666;" value='User'>User</option>
          <option style="color:#666;" value='All Other'>All Other</option>
        </select>

      <label for="ContactFormMarket" class="label--hidden1">Market</label>
        <input type="text" id="ContactFormMarket" name="contact[Market]" placeholder="Market">
    {%endcomment%}
        
        {% unless fs_shop_active %}
        <label for="ContactFormRegion" class="label--hidden1">Region</label>
        <select name="contact[Region]" title="Region" required oninvalid="this.setCustomValidity('Must select the region you are associated with.')" onchange="this.setCustomValidity('')" id="ContactFormRegion" style="color: #666;" onchange="this.style.color = '#000';" >
          <option style="color:#666; background-color:lightgray;" value="" selected disabled>Select Region</option>
          <option style="color:#666;" value='Region:California'>California/Mountain</option>
          <option style="color:#666;" value='Region:GreatLakes'>Great Lakes/NorthEast</option>
          <option style="color:#666;" value='Region:MidAtlantic'>Mid-Atlantic/MetroAtlantic</option>
<!--           <option style="color:#666;" value='Region:Mountain'>Mountain</option> -->
          <option style="color:#666;" value='Region:MidWest'>MidWest</option>
<!--           <option style="color:#666;" value='Region:NorthEast'>NorthEast</option> -->
          <option style="color:#666;" value='Region:S0uth'>South</option>
          <option style="color:#666;" value='Region:SouthEast'>SouthEast/Sunbelt</option>
        </select>
        {% endunless %}

        {% if fs_shop_active %}
        <label for="ContactFormRole" class="label--hidden1">Do you have budget approver responsibilities ?</label>
        <select name="contact[userRole]" title="Role" required id="ContactFormRole" style="color: #666;" onchange="this.style.color = '#000';" > 
          <option style="color:#666;" selected value='Role:FSUser'>No</option>
          <option style="color:#666;" value='Role:ChannelManager'>Yes</option>
        </select>
        {% else %}
        <label for="ContactFormRole" class="label--hidden1">Do you have people reporting to you whose orders you would like to see ?</label>
        <select name="contact[userRole]" title="Role" required id="ContactFormRole" style="color: #666;" onchange="this.style.color = '#000';" > 
          <option style="color:#666;" selected value='Role:SiteUser'>No</option>
          <option style="color:#666;" value='Role:UserManager'>Yes</option>
          {% endif %}
        </select>
      
    {% comment %}
        <input class="text-center1" type="text" required id="ContactFormRole" disabled name="" placeholder="" value="Do you have people reporting to you whose orders you would like to see ?">
        <div class="text-center">
          <label  style="display:initial;"><input type="radio" value="Role:UserManager" name="contact[userRole]"/> Yes</label>
          <label  style="display:initial; padding-left:20px;"><input type="radio" checked="checked" value="Role:SiteUser" name="contact[userRole]"/> No</label>
        </div>        
        
        <label for="ContactFormPass" class="label--hidden1">Password</label>
        <input id="ContactFormPass" required type="password" name="" value="">
        <label for="ContactFormConfirmPass" class="label--hidden1">Confirm Password</label>
        <input id="ContactFormConfirmPass" required type="password" name="" value="">
        
        <div class="hidden">
          <input id="ContactFormStreet" type="hidden" name="" value="{{ shop.address.street }}">
          <input id="ContactFormCity" type="hidden" name="" value="{{ shop.address.city }}">
          <input id="ContactFormProvince" type="hidden" name="" value="{{ shop.address.province }}">
          <input id="ContactFormZip" type="hidden" name="" value="{{ shop.address.zip }}">
          <input id="ContactFormCountry" type="hidden" name="" readonly value="{{ shop.address.country }}">
          <!-- <input id="ContactFormMarket" type="hidden" name="" value="{{ shop.address.street }}"> -->
        </div>
        {% endcomment %}
      
        <div style="padding-top:50px;" class="text-center">
        <input type="submit" class="btn btn-primary" value="Submit Registration Request">
          <br><br><a href="/account/login" class="btn">Cancel</a>
        </div>
      {% endif %}
      {% endform %}
      
   </div>
 </div>
</div>

<script>
  
  window.onerror = function(error){
    // do your stuff
    console.log(error.message);
  }
  
  var formData = '';
  
  $(function() {
    $('select[required], input[required]').before('<span style="color: red; position:absolute; left: 15px;">*</span>');
  });
  
  
  $('#contact_form').bind('submit', function(e, obj){ 
    e.preventDefault();
    if(isIE())
      iePause();  
    else
      ajaxSubmit();
  });

  function onRegionChange(obj) {
    // value = $(obj).val().split(":")[1].replace(' ','');
    values = $('#ContactFormDivision, #ContactFormLegacyRegion, #ContactFormChannel').map(function(){ return this.value.replace(' ', '').split(":")[1]||"" }).get();
    // console.log(values);
    if(values.indexOf("FranchiseBottler") != -1 || values.indexOf("NationalCustomer") != -1){
      $('#ContactFormRole').val('Role:ChannelManager').prop('disabled', true);
    }else
      $('#ContactFormRole').val('Role:FSUser').prop('disabled', false);
  }
                          
  function ajaxSubmit(){
  
    freez();
    
    var data = { customer : {} };
    
    data.customer["first_name"] = $('#ContactFormFirstName').val();
    data.customer["last_name"] = $('#ContactFormLastName').val();
    data.customer["phone"] = $('#ContactFormPhone').val();
    data.customer["region"] = $('#ContactFormRegion').val();
    data.customer["role"] = $('[name = "contact[userRole]"]').val();
    data.customer["email"] = $('#ContactFormEmail').val();
    data.customer["address1"] = $('#ContactFormStreet').val();
    data.customer["city"] = $('#ContactFormCity').val();
    data.customer["province"] = $('#ContactFormProvince').val();
    data.customer["zip"] = $('#ContactFormZip').val();
    data.customer["country"] = $('#ContactFormCountry').val();
    data.customer["company"] = $('#ContactFormCompanyName').val();

    {% if fs_shop_active %}
    data.customer["division"] = $('#ContactFormDivision').val();
    data.customer["region"] = $('#ContactFormLegacyRegion').val();
    data.customer["legacy_region"] = $('#ContactFormLegacyRegion').val();
    data.customer["channel"] = $('#ContactFormChannel').val();
    data.customer["moddivision"] = $('#ContactFormDivision').val().replace(':', 'MOD:');
    data.customer["modregion"] = $('#ContactFormLegacyRegion').val().replace(':', 'MOD:');
    $('[name="contact[modregion]"]').val(data.customer["modregion"]);
    $('[name="contact[moddivision]"]').val(data.customer["moddivision"]);
    {% endif %}
    
    formData = JSON.stringify(data);
    
    console.log(JSON.stringify(data));
    
    {% comment %}{% endcomment %}
    $.ajax({
      url: '/apps/pepsi-print/{%- if fs_shop_active -%}fs_{%- endif -%}customer/registration.json',
          type: 'POST',
          data: formData,
          dataType: 'json',
          contentType: "application/json;",
          statusCode: {
            401:function() { console.log("401") },
            404:function() { console.log("404"); },
            200:function() { console.log("200"); },
            201:function() { console.log("201"); },
            202:function() { console.log("202"); }
          },
          success: function(data){
              console.log(JSON.stringify(data));
              
                if(200 === Number(data.status)){ console.log("unbiding");
                  if(formData.toLowerCase().indexOf("test") == -1){
                    $('#contact_form').unbind('submit').delay(500).submit();
                  }else{
                    show_message2("Test account created, activation link sent to your email. ",true);
                    setTimeout(function(){ window.location.assign('/account/login'); },4000);
                  }
                    
                }else if(401 === Number(data.status)){
                  show_message2(data.message,false);
                }else{
                  show_message2(data.message,false); 
                  console.log('else');
                }
           
            
              
          },
          error: function(data){
            show_message2(((data.message != undefined) ? data.message : 'Some Error Occured.'),false);
          }
          
   });
    
    
    
    //return false;
  
  
  }
  
  
  
</script>
