{% include 'customer-account-common-code' with 'theme-layout-code' %}

{% if checkout.attributes["Parent ID"] == blank %}    
  <meta content="0; url=/cart" http-equiv="refresh" />
  {% continue %}
{% endif %}

{% if checkout.attributes["Budget Code"] != blank %}
  {% assign fs_shop_active = true %}
{% endif %}

<!DOCTYPE html>
<html lang="{{ locale }}" dir="{{ direction }}" class="{{ checkout_html_classes }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, user-scalable=0">
    <meta name="referrer" content="origin">

    <title>{{ page_title }}</title>

    {{ content_for_header }}

    {% if settings.favicon %}
      {% if fs_shop_active %}
        {% assign settings_favicon = settings.favicon_mod %}
        <link href="//fonts.googleapis.com/css?family=Ubuntu:400,700" rel="stylesheet" type="text/css" media="all" />
        <style> *{ font-family: "Ubuntu","HelveticaNeue","Helvetica Neue",sans-serif !important; } </style>
        <style type="text/css">
          *{ border-radius: 2px !important; }
        </style>
      {% else %}
        {% assign settings_favicon = settings.favicon %}
      {% endif %}
      <link rel="shortcut icon" href="{{ settings_favicon | img_url: '32x32' }}" type="image/png" />
    {% endif %}

    <script type="text/javascript">console.log('{{ checkout. }}');</script>

    <script type="text/javascript">
      // if(document.referrer.indexOf() == -1){
      //   window.location.assign("/cart");
      // }
      console.log("Refere:"+document.referrer);
    </script>

    {{ checkout_stylesheets }}
    {{ checkout_scripts }}

    {{ '//ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js' | script_tag }}

    <style id="temp-style">
      .total-recap__final-price{ visibility: hidden !important; }
    </style>

    <!-- BeginConsistentCartAddon -->  <script>  {% if customer %}  Shopify.merge_cart_text = '{{ "consistent_cart_addon.merge_cart_text" | t }}' ;  Shopify.customer_logged_in = true ;  Shopify.customer_email = "{{ customer.email }}" ;  Shopify.log_uuids = true;  {% else %}  Shopify.customer_logged_in = false ;  Shopify.customer_email = "" ;  Shopify.log_uuids = true;  {% endif %}  </script>  
    <!-- EndConsistentCartAddon -->

    <!--BeginCFFPersistentCartCart-->
    {% if customer %}
      <script>
        // console.log('csu:{{current_shop_url}}');
        window.cffCustomer = {
            name: '{{customer.name}}',
            email: '{{customer.email}}',
            hasAccount: '{{customer.has_account}}',
            id: '{{customer.id | hmac_sha1: current_shop_url}}'
        };
      </script>
    {% endif %}

    <script>
        window.cffPCLiquidPlaced = true
    </script>

    <!--EndCFFPersistentCartCart-->
  </head>
  <body>
    {{ skip_to_content_link }}
    <div class="banner" data-header>
      <div class="wrap">
        {% if fs_shop_active %}
          {{ content_for_logo | replace: "//cdn.shopify.com/s/files/1/2142/6089/files/HOR_LOGO1.png", "//cdn.shopify.com/s/files/1/2142/6089/files/2347F4DE-5297-4B7A-89E2-76796C8A62C2__png.jpg" }}
        {% else %}
          {{ content_for_logo }}
        {% endif %}
      </div>
    </div>

    {{ order_summary_toggle }}

    <div class="content" data-content>
      <div class="wrap">
        <div class="main" role="main">
          <div class="main__header">
            {% if fs_shop_active %}
              {{ content_for_logo | replace: "//cdn.shopify.com/s/files/1/2142/6089/files/HOR_LOGO1.png", "//cdn.shopify.com/s/files/1/2142/6089/files/2347F4DE-5297-4B7A-89E2-76796C8A62C2__png.jpg" }}
            {% else %}
              {{ content_for_logo }}
            {% endif %}
        
            {{ breadcrumb }}
            {{ alternative_payment_methods }}
          </div>
          <div class="main__content">
            {{ content_for_layout }}
          </div>
          <div class="main__footer">
            {{ content_for_footer }}
          </div>
        </div>
        <div class="sidebar" role="complementary">
          <div class="sidebar__header">
            {{ content_for_logo }}
          </div>
          <div class="sidebar__content">
            {{ content_for_order_summary }}
          </div>
        </div>
      </div>
    </div>

    {{ tracking_code }}

    {% if customer.tags contains region_NorthEast %}
  	<style>
        .content-box__row:nth-of-type(2){ display:none; }
      </style>
    {% endif %}

    <script>
        var payment_cc, payment_cd;

        $(document).ready(function(){
          startPCC();

        });

        function startPCC(){
          if($('button[type="submit"] span.btn__content:contains("COMPLETE ORDER")').parent().length > 0)
          	payment_cc = setInterval(function(){ //console.log('running')

              total_due = $('div[data-order-summary-section="payment-lines"]').first().find('span[data-checkout-payment-due-target]').attr('data-checkout-payment-due-target');

              if( ($('form[data-reduction-form="true"]').length > 0) || (total_due == '0') )
              	releaseBtn();
              else
              	siezeBtn();
            },100);
        }

        function siezeBtn(){
            $('form[data-payment-form]').unbind('submit').bind('submit', function(e){
              e.preventDefault(); console.log('payment code required');
            });

            $('button[type="submit"] span.btn__content:contains("COMPLETE ORDER")').parent().addClass('disabled blink_me').off('click').on('click', function(e){
              e.preventDefault();
              $('#checkout_reduction_code')[0].focus();
              $(window).scrollTop(0); console.log('clicked');
            });

        }

        function releaseBtn(){
          $('form[data-payment-form]').unbind('submit');
          $('button[type="submit"] span.btn__content:contains("COMPLETE ORDER")').parent().removeClass('disabled blink_me').off('click');

        }
    </script>

    <style>
        button[type='submit'].step__footer__continue-btn.disabled{
          background: #ccc !important;
          cursor: not-allowed;
          position:relative;
        }

        button[type='submit'].step__footer__continue-btn.disabled:after{
          content:'Payment Code Required';
          color:red;
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          -webkit-transform: translateX(-50%);
          -ms-transform: translateX(-50%);
          top: 110%;
          white-space: nowrap;
          margin-bottom: 15px;
        }

        button[type='submit'].step__footer__continue-btn.disabled.blink_me:after {
          animation: blinker 1.5s linear infinite;
        }

        @keyframes blinker {
          50% { opacity: 0; }
        }
    </style>
   {% include 'mesh-window-checkout' %}

  </body>
</html>
